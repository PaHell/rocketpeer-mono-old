generator client {
  provider = "cargo prisma"
  output   = "../src/prisma.rs"
}

datasource db {
  provider = "mysql"
  url      = env("RUST_DB_URL")
}

model users {
  id               Int                 @id @default(autoincrement())
  user_name        String              @unique
  password         String
  display_name     String?
  first_name       String
  last_name        String
  image            Bytes               @db.Blob
  status           users_status
  email            String              @unique
  privacy_level    users_privacy_level
  role             users_role
  created_at       DateTime            @default(now())
  friends_user_1   user_friends[]      @relation("friends_user_1")
  friends_user_2   user_friends[]      @relation("friends_user_2")
  message_sender   message[]           @relation("message_sender")
  message_receiver message[]           @relation("message_receiver")
}

model user_friends {
  id             Int      @id @default(autoincrement())
  user_1_id      Int
  user_2_id      Int
  created_at     DateTime @db.DateTime(0)
  friends_user_1 users    @relation("friends_user_1", fields: [user_1_id], references: [id], onUpdate: Restrict, map: "user_1")
  friends_user_2 users    @relation("friends_user_2", fields: [user_2_id], references: [id], onUpdate: Restrict, map: "user_2")

  @@index([user_1_id], map: "user_1")
  @@index([user_2_id], map: "user_2")
}

model message {
  id               Int          @id @default(autoincrement())
  sender_id        Int
  receiver_id      Int
  type             message_type
  payload          String       @db.LongText
  created_at       DateTime     @default(now())
  deleted_at       DateTime
  message_sender   users        @relation("message_sender", fields: [sender_id], references: [id], map: "sender_id")
  message_receiver users        @relation("message_receiver", fields: [receiver_id], references: [id], map: "receiver_id")
}

enum users_status {
  online
  away
  do_not_disturb
  offline
}

enum users_privacy_level {
  default
}

enum users_role {
  administrator
  default
}

enum message_type {
  text
  picture
  video
  gif
}
